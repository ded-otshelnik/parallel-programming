# Разработка на Си с помощью Visual Studio Code на удаленных машинах

## Описание проблемы

Работа с языком Си в сопредполагает наличие соответствующей среды, в частности, нормального компилятора и, опционально, хорошего редактора для кода. Но если для UNIX-подобных систем (Linux, MacOS) это не вызывает проблем, то для Windows подобный набор обеспечить достаточно сложно.

Проблемы с Windows связаны с тем, что на системном уровне разработчики реализовали "по-своему" операционную систему: они очень не любят язык Си, но при этом ОС активно использует родственный язык С++, который был создан на основе Си. В связи с этим любая более-менее серьезная разработка на языке Си там невозможна, скажем так, без "плясок с дудкой". Microsoft Visual Studio - официальный IDE для работы с C++ и C# (другой С-подобный язык, который помимо разработки под Windows используется в геймдеве) - имеет совместимость со стандартом С89 языка Си, но всякий раз будет пытаться насыпать всякого ненужного прямиком из С++.

Впрочем, есть способы как работать с языком Си более-менее адекватно. Однако, все они связаны так или иначе с работой либо с **виртуальной машиной** Linux, либо с **удаленной машиной** Linux.

В данном туториале будет описано два способа:

1. Установка **Windows Subsystem for Linux (WSL)**.
2. Разработка на удаленной машине **через SSH-соединение**.

## VSCode - IDE для работы с Си и Linux

[**Visual Studio Code**](https://code.visualstudio.com/) - это кроссплатформенный легковесный редактор кода с возможностью почти безграничного расширения функционала и настройки под любой язык программирования. Скачать его для Windows можно [по этой ссылке](https://code.visualstudio.com/docs/setup/windows), для MacOS - [здесь](https://code.visualstudio.com/docs/setup/mac).

Гибкость VSCode состоит в том, что благодаря **расширениям** добавляется поддержка практически для всего набора языков/технологий/типов файлов и т.д. В частности, имеется поддержка для Cи, поэтому далее будет использоваться именно этот редактор.

Главное расширение, которое потребуется - [C/C++ Extension Pack](https://marketplace.visualstudio.com/items?itemName=ms-vscode.cpptools-extension-pack). Это пакет расширений, которые чаще всего применяются для работы с С и С++.

Но главное преимущество работы с VSCode - работа с удаленными серверами/компьютерами через SSH-соединение. Во втором способе будет подробно описано как реализовать SSH-соединение для произвольного компьютера с рабочим SSH-ключом.

## Способ 1: Windows Subsystem for Linux (WSL)

### Установка WSL

В большинстве случаев, для разработки на Си (также на С++) хватает установки виртуальной машины. Компания Microsoft специальный софт - [**Windows Subsystem for Linux (WSL)**](https://learn.microsoft.com/ru-ru/windows/wsl/install), который позволяет запускать нативно виртуальный Linux внутри обычной Windows без сепарирования основного компьютера и виртуалки или установки полноценной ОС на компьютер с вытекающей отсюда головной болью.

Более того, установка WSL осуществляется через **Windows Powershell** - встроенную командную строку Windows - всего одной командой (правда, на правах администратора):

```powershell
wsl --install
```

И все! На компьютере будет стоять готовый менеджер для виртуалок Linux.

По умолчанию ставится дистрибутив Ubuntu (разновидность Linux). При запуске новой виртуалки _wsl_ попросит придумать имя пользователю и пароль для него, что стандартно для этой ОС.

Чтобы просмотреть доступные дистрибутивы, можно выполнить следующую команду:

```powershell
wsl --list --online
```

Выбрав нужный диструбутив, ставится он тоже достаточно легко:

```powershell
wsl --install -d <DistroName>
```

При необходимости ненужное удаляется:

```powershell
wsl --unregister <DistributionName>
```

Список доступных команд можно посмотреть [здесь](https://learn.microsoft.com/ru-ru/windows/wsl/basic-commands#unregister-or-uninstall-a-linux-distribution).

### Настройка VSCode

Для работы с WSL в VSCode понадобится всего одно расширение - [WSL](https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-wsl). Оно интегрирует в VSCode механизм подключения к виртуалке, что позволяет запускать сессию на виртуалке и работать там как на удаленной машине (про удаленные машины позже). Вы получаете все преимущества разработки под Linux, не выходя из Windows, посредством VSCode.

После установки через F1 > WSL: Connect to WSL запускается процесс настройки на другой стороне подключения.

![Заход на WSL](images/remote/connect-to-wsl.png)

После загрузки VSCode предложит открыть папку (или не предложит, тогда нажимаем Open Folder). Ничего не трогая, соглашаемся с предложенным вариантом (по умолчанию открывается папка пользователя).

![Заход в каталог пользователя](images/remote/open-user-folder.png)

Готово. Вы на виртуалке внутри Windows.

![Как примерно выглядит VSCode на WSL](images/remote/user-wsl.png)

### Недостатки подхода

WSL - достаточно удобный механизм для разработки под Linux, но для параллельного программирования WSL врядли подойдет. Не потому, что это виртуалка внутри Windows, а потому, что ресурсов среднестатистического компьютера, даже с относительно топовой сборкой, не хватит для реальных параллельных алгоритмов, поскольку обычно параллельные алгоритмы показывают свою эффективность на больших объемах данных, что в условиях ПК недостижимо.

Для параллельных вычислений лучше всего подходит специально сконструированный компьютер - **суперкомпьютер**. Разработка и впринципе работа с ним возможна только удаленно, т.е. требуется рабочее SSH-соединение. Удаленная разработка будет расмотрена в следующем разделе.

## Способ 2: Удаленная разработка

### Технические требования

Убедитесь, что на целевой машине есть рабочий SSH-ключ, а на вашем компьютере есть SSH-клиент, (!) но не PuTTY, которое не поддерживается VSCode (в Windows с недавних пор есть OpenSSH клиент).

### Расширение VSCode для SSH

Для разработки через SSH требуется всего один пакет расширений - [Remote - SSH](https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-ssh), который позволяет подключаться к удаленным машинам и работать там.

После установки появится зеленая кнопка в левом нижнем углу, которая открывает меню для подключения к удаленной машине.

![Зеленая кнопка](images/remote/open-remote-window.png)

Перед запуском потребуется настроить авто подключение, чтобы не требовалось постоянно вводить логин/пароль и т.п. Для этого нужно прописать в **конфигурационный файл** (обычно он лежит в папке С:\\Users\\<пользователь>\\.ssh) нужную информацию. Через F1 > Remote-SSH: Open SSH Configuration File откроется файл конфигурации. Например, для суперкомпьютера ВГУ (открытый домен - hpc.cs.vsu.ru) требуется ввести следующее:

```ssh-config
Host hpc.cs.vsu.ru
    HostName hpc.cs.vsu.ru
    User yourname
    IdentityFile ~/.ssh/<файл с приватным ключом>
```

Важно: IdentityFile - это файл, содержащий приватный ключ, т.е. это файл, начинающийся с **-----BEGIN RSA PRIVATE KEY-----** и заканчивающийся на **-----END RSA PRIVATE KEY-----**, а между этими строками содержащий приватный ключ.

После настройки через зеленую кнопку в левом нижнем углу откроется меню, где выбираем Connect to Host (или Connect Current Window to Host). Высветится список доступных хостов: для суперкомпа выбираем hpc.cs.vsu.ru, после чего пройдет авторизация через SSH-ключ, указанный в конфиг-файле.

Если авторизация успешна и VSCode первый раз подключается к удаленной машине, на нее скачивается и устанавливается папка .vscode-server, содержащий нужную информацию для IDE по используемой машине, локальные расширения VSCode на этой машине и т.п. После удачной настройки откроется Explorer, терминал и т.п.

![Окно суперкомпьютера](images/remote/supercomputer-entrance.png)

Поскольку суперкомпьютер - вещь достаточно древняя, то VSCode выдает сообщение, что версия ОС не поддерживается, но на самом деле все прекрасно работает (пока). Выбираем Open Folder, открываем предложенную папку пользователя.

![Пользователь на суперкомпе](images/remote/user.png)

Поздравляем! Вы зашли на суперкомпьютер, по совместительству, удаленную машину.

## Заключение

В туториале рассмотрены способы разработки под Linux на VSCode с помощью WSL и с помощью удаленной машины через SSH.
